const { getTime } = global.utils;

module.exports = {
  config: {
    name: "autoinvite",
    version: "2.5",
    author: "Mohammad Akash",
    category: "events"
  },

  onStart: async ({ api, event, usersData, message }) => {
    if (event.logMessageType !== "log:unsubscribe") return;

    const { threadID, logMessageData, author } = event;
    const leftID = logMessageData.leftParticipantFbId;

    // ржпржжрж┐ ржХрзЗржЙ ржирж┐ржЬрзЗрж░ ржЗржЪрзНржЫрж╛рзЯ рж▓рж┐ржн ржирзЗрзЯ (kick ржирж╛)
    if (leftID === author) {
      const userName = await usersData.getName(leftID);

      // Messenger-friendly bold font map
      const boldMap = {
        A: "ЁЭЧФ", B: "ЁЭЧХ", C: "ЁЭЧЦ", D: "ЁЭЧЧ", E: "ЁЭЧШ", F: "ЁЭЧЩ", G: "ЁЭЧЪ", H: "ЁЭЧЫ", I: "ЁЭЧЬ", J: "ЁЭЧЭ",
        K: "ЁЭЧЮ", L: "ЁЭЧЯ", M: "ЁЭЧа", N: "ЁЭЧб", O: "ЁЭЧв", P: "ЁЭЧг", Q: "ЁЭЧд", R: "ЁЭЧе", S: "ЁЭЧж", T: "ЁЭЧз",
        U: "ЁЭЧи", V: "ЁЭЧй", W: "ЁЭЧк", X: "ЁЭЧл", Y: "ЁЭЧм", Z: "ЁЭЧн",
        a: "ЁЭЧо", b: "ЁЭЧп", c: "ЁЭЧ░", d: "ЁЭЧ▒", e: "ЁЭЧ▓", f: "ЁЭЧ│", g: "ЁЭЧ┤", h: "ЁЭЧ╡", i: "ЁЭЧ╢", j: "ЁЭЧ╖",
        k: "ЁЭЧ╕", l: "ЁЭЧ╣", m: "ЁЭЧ║", n: "ЁЭЧ╗", o: "ЁЭЧ╝", p: "ЁЭЧ╜", q: "ЁЭЧ╛", r: "ЁЭЧ┐", s: "ЁЭША", t: "ЁЭШБ",
        u: "ЁЭШВ", v: "ЁЭШГ", w: "ЁЭШД", x: "ЁЭШЕ", y: "ЁЭШЖ", z: "ЁЭШЗ"
      };

      const boldName = userName.split("").map(c => boldMap[c] || c).join("");

      const form = {
        body: `ЁЯМ╕ ржЖрж░рзЗ ржЖрж░рзЗ... ржПржЗржнрж╛ржмрзЗ ржЪрзБржкрж┐ржЪрзБржкрж┐ рж▓рж┐ржн ржирж┐рж▓рзЗ ржирж╛ржХрж┐? ЁЯШ╣  
${boldName}  

ЁЯТм ржЧрзНрж░рзБржк ржерзЗржХрзЗ рж▓рж┐ржн ржирзЗржУрзЯрж╛ ржПржд рж╕рж╣ржЬ ржнрж╛ржмржЫрзЛ ржирж╛ржХрж┐? ЁЯШП  
ЁЯСС ржпрзЗ ржЧрзНрж░рзБржкрзЗ ржЖржорж┐ ржЖржЫрж┐... рж╕рзЗржЦрж╛ржирзЗ рж▓рж┐ржн ржирзЗржУрзЯрж╛ ржорж╛ржирзЗ ржорж┐рж╢ржи ржЗржорзНржкрж╕рж┐ржмрж▓! ЁЯР╕  

тЪая╕П рждрж╛ржЗ ржЖржмрж╛рж░ рж╕ржорзНржорж╛ржирзЗрж░ рж╕рж╛ржерзЗ ржЕрзНржпрж╛ржб ржХрж░рзЗ ржжрж┐рж▓рж╛ржо ЁЯШЗ  
тЬи ржПржмрж╛рж░ ржЖрж░ ржкрж╛рж▓рж╛ржирзЛрж░ ржЪрзЗрж╖рзНржЯрж╛ ржХржЗрж░рзЛ ржирж╛ ржХрж┐ржирзНрждрзБ! ЁЯШВ  

тФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБ
ЁЯСС ЁЭЧвЁЭШДЁЭЧ╗ЁЭЧ▓ЁЭЧ┐ : ЁЭЧЮЁЭЧоЁЭЧ╕ЁЭЧоЁЭШАЁЭЧ╡ЁЭЧ╢ ЁЯТО
тФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБ`
};
      };

      try {
        await api.addUserToGroup(leftID, threadID);
        await message.send(form);
      } catch (err) {
        message.send("тЪая╕П ржжрзБржГржЦрж┐ржд, ржЖржорж┐ ржЗржЙржЬрж╛рж░ржЯрж╛ржХрзЗ ржЖржмрж╛рж░ ржЕрзНржпрж╛ржб ржХрж░рждрзЗ ржкрж╛рж░рж┐ржирж┐ред рж╕ржорзНржнржмржд ржЕрзНржпрж╛ржб ржмрзНрж▓ржХ ржХрж░рж╛ ржЖржЫрзЗред");
      }
    }
  }
};
